#!/bin/bash

# Script to 'wrap' around git and update ChangeLog and version / date in file.

COMMITFILE="none"
COMMITMSG="none"
COMMITTYPE="none"
BUMP="false"
PUSH="true"

# Parse CLI arguments / options
USAGE1="commit [-F <filename>] [-m <text>] [-t] [-n]"

while getopts "F:m:bn" options; do
  case $options in
    F ) COMMITFILE=$OPTARG
	COMMITTYPE="file"
        echo "Using file "$COMMITFILE" for commit message.";;
    m ) COMMITMSG=$OPTARG
	COMMITTYPE="msg"
        echo "Using supplied text for commit message.";;
    b ) BUMP="true"
	echo "Version (patch) number will be bumped.";;
    n ) PUSH="false"
	echo "Files will be committed but not pushed to server.";;
    \? ) echo -e $USAGE1
         exit 1;;
    * ) echo -e $USAGE1
        exit 1;;
  esac
done

# Check that a commit type was given
if [ "$COMMITTYPE" = "none" ]
then
  echo "No commit message/file was given."
  exit 0
fi

# Bump version if requested
if [ "$BUMP" = "true" ]
then
  ./changeversion bump tag
else
  ./changeversion
fi

# Commit changes
if [ "$COMMITTYPE" = "file" ]
then
  git commit -a -F $COMMITFILE
fi
if [ "$COMMITTYPE" = "msg" ]
then
  git commit -a -m "$COMMITMSG"
fi

# Push changes to server?
if [ "$PUSH" = "true" ]
then
  git push --tags
fi

exit 0
